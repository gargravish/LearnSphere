/*! For license information please see popup.js.LICENSE.txt */
(()=>{"use strict";var e,t={20:(e,t,s)=>{var n=s(540),o=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,s){var n,r={},l=null,d=null;for(n in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!c.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:o,type:e,key:l,ref:d,props:r,_owner:i.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},131:(e,t,s)=>{var n=s(848),o=s(540),r=s(338),a=s(329);r.createRoot(document.getElementById("root")).render((0,n.jsx)(o.StrictMode,{children:(0,n.jsx)(()=>{const[e,t]=(0,o.useState)(""),[s,r]=(0,o.useState)(!1),[i,c]=(0,o.useState)(!1),[l,d]=(0,o.useState)(""),[u,p]=(0,o.useState)(!1),[h]=(0,o.useState)(()=>a.h.getInstance());(0,o.useEffect)(()=>{g()},[]);const g=async()=>{console.log("LearnSphere Popup: Loading settings..."),await h.reloadSettings();const e=h.getGeminiApiKey();console.log("LearnSphere Popup: Retrieved API key:",e?"EXISTS":"NOT FOUND"),t(e||"");const s=h.validateApiKey(e);if(r(s),console.log("LearnSphere Popup: API key valid:",s),s&&e)try{console.log("LearnSphere Popup: Testing API key...");const t=await h.testApiKey(e);console.log("LearnSphere Popup: API key test result:",t),p(t.valid),t.valid&&(await m(),u&&(d("Extension is already active! Closing popup..."),setTimeout(()=>{window.close()},1500)))}catch(e){console.error("LearnSphere Popup: Error testing API key:",e),p(!1)}else console.log("LearnSphere Popup: API key not valid or missing"),p(!1)},m=async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e.id)if(e.url&&e.url.toLowerCase().includes(".pdf")){const t=await chrome.tabs.sendMessage(e.id,{action:"checkExtensionStatus"});t&&t.active&&(d("Extension is already active on this page! Closing popup..."),p(!0),setTimeout(()=>{window.close()},2e3))}else d("Navigate to a PDF page to use LearnSphere"),setTimeout(()=>d(""),3e3)}catch(e){console.log("Extension status check: Content script not loaded yet")}},y=async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t.id&&(await chrome.tabs.sendMessage(t.id,{action:"activateExtension",apiKey:e}),await chrome.tabs.sendMessage(t.id,{action:"showReadyMessage",message:"LearnSphere is now active! Select text in the PDF to start learning."}))}catch(e){console.log("Extension activation message sent (content script may not be loaded yet)")}};return(0,n.jsxs)("div",{className:"popup",children:[(0,n.jsxs)("div",{className:"popup-header",children:[(0,n.jsx)("h1",{children:"LearnSphere"}),(0,n.jsx)("p",{children:"AI-Powered PDF Learning Assistant"})]}),(0,n.jsxs)("div",{className:"popup-content",children:[(0,n.jsxs)("div",{className:"api-key-section",children:[(0,n.jsx)("h3",{children:"Gemini API Configuration"}),(0,n.jsxs)("p",{className:"description",children:["Enter your Google Gemini API key to enable AI features. Get your key from ",(0,n.jsx)("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",children:"Google AI Studio"}),"."]}),(0,n.jsxs)("div",{className:"input-group",children:[(0,n.jsx)("input",{type:"password",value:e,onChange:e=>{const s=e.target.value;t(s),r(h.validateApiKey(s)),d(""),p(!1)},placeholder:"Enter your Gemini API key",className:s?"valid":e?"invalid":""}),(0,n.jsxs)("div",{className:"validation-indicator",children:[s&&(0,n.jsx)("span",{className:"valid",children:"âœ“"}),e&&!s&&(0,n.jsx)("span",{className:"invalid",children:"âœ—"})]})]}),(0,n.jsxs)("div",{className:"button-group",children:[(0,n.jsx)("button",{onClick:async()=>{if(s){c(!0),d("");try{await h.setGeminiApiKey(e),(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:"Hello"}]}],generationConfig:{temperature:.1,topK:1,topP:.1,maxOutputTokens:10}})})).ok?(d("API key saved and tested successfully!"),p(!0),await y(),await g(),setTimeout(()=>{d("Extension activated! Closing popup..."),setTimeout(()=>{window.close()},1e3)},2e3)):(d("API key saved but test failed. Please check your key."),p(!1),setTimeout(()=>d(""),5e3))}catch(e){d("Failed to save API key. Please try again."),console.error("Error saving API key:",e)}finally{c(!1)}}else d("Please enter a valid Gemini API key")},disabled:!s||i,className:"primary-button",children:i?"Saving...":"Save API Key"}),(0,n.jsx)("button",{onClick:async()=>{c(!0);try{await h.setGeminiApiKey(""),t(""),r(!1),d("API key cleared successfully!")}catch(e){d("Failed to clear API key. Please try again.")}finally{c(!1)}},disabled:!e||i,className:"secondary-button",children:"Clear"})]}),l&&(0,n.jsx)("div",{className:"message "+(l.includes("successfully")?"success":"error"),children:l})]}),(0,n.jsxs)("div",{className:"features-section",children:[(0,n.jsx)("h3",{children:"Features"}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"âœ… PDF Viewer Override"}),(0,n.jsx)("li",{children:"âœ… Text & Area Selection"}),(0,n.jsx)("li",{children:"âœ… Highlighting System"}),(0,n.jsx)("li",{children:"âœ… Chat Sidebar"}),(0,n.jsxs)("li",{children:[u?"âœ…":"âŒ"," AI Chat (Gemini)"]}),(0,n.jsxs)("li",{children:[u?"âœ…":"âŒ"," Document Summaries"]}),(0,n.jsxs)("li",{children:[u?"âœ…":"âŒ"," Quiz Generation"]})]}),(0,n.jsxs)("div",{className:"api-status "+(u?"active":"warning"),children:[(0,n.jsx)("div",{className:"status-indicator",children:u?"âœ…":"âš ï¸"}),(0,n.jsx)("span",{children:u?"API Key Active & Working":"API Key Saved but Not Working"})]}),u&&(0,n.jsxs)("div",{className:"extension-status",children:[(0,n.jsx)("div",{className:"status-indicator active",children:"ðŸš€"}),(0,n.jsx)("span",{children:"Extension Ready to Use"})]}),u&&(0,n.jsxs)("div",{className:"user-instructions",children:[(0,n.jsx)("h3",{children:"ðŸŽ¯ How to Use LearnSphere:"}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Select Text:"})," Click and drag to select any text in the PDF"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Chat Button:"}),' A "ðŸ’¬ Chat about this" button will appear above your selection']}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Click to Chat:"})," Click the button to open the AI chat sidebar"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Ask Questions:"})," Ask the AI about the selected text, request summaries, or generate quizzes"]})]}),(0,n.jsxs)("div",{className:"instruction-note",children:["ðŸ’¡ ",(0,n.jsx)("strong",{children:"Tip:"})," The popup will close automatically so you can start using the extension!"]})]})]}),(0,n.jsxs)("div",{className:"actions-section",children:[(0,n.jsx)("button",{onClick:()=>{chrome.runtime.openOptionsPage()},className:"secondary-button",children:"Open Settings"}),(0,n.jsx)("button",{onClick:g,className:"refresh-button",children:"Refresh Status"}),u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:y,className:"activate-button",children:"Activate Extension"}),(0,n.jsx)("button",{onClick:async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id)return d("No active tab found. Please refresh and try again."),void setTimeout(()=>d(""),3e3);if(!e.url||e.url.startsWith("chrome://")||e.url.startsWith("chrome-extension://"))return d("Cannot open sidebar on this page. Please navigate to a regular webpage."),void setTimeout(()=>d(""),5e3);console.log("LearnSphere Popup: Attempting to open sidebar on tab:",e.id,"URL:",e.url);try{await chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]}),console.log("LearnSphere Popup: Content script injected successfully");try{await chrome.scripting.insertCSS({target:{tabId:e.id},files:["content.css"]}),console.log("LearnSphere Popup: CSS injected successfully")}catch(e){console.log("LearnSphere Popup: CSS injection failed (may already be loaded):",e)}}catch(e){console.log("LearnSphere Popup: Content script may already be loaded:",e)}console.log("LearnSphere Popup: Waiting for content script to initialize..."),await new Promise(e=>setTimeout(e,1e3));let t=0;const s=3;let n=null;for(;t<s&&!n;)try{console.log(`LearnSphere Popup: Attempt ${t+1} to send message...`),n=await chrome.tabs.sendMessage(e.id,{action:"openChatSidebar"}),console.log("LearnSphere Popup: Sidebar response received:",n);break}catch(e){t++,console.log(`LearnSphere Popup: Message attempt ${t} failed:`,e),t<s&&(console.log("LearnSphere Popup: Retrying in 500ms..."),await new Promise(e=>setTimeout(e,500)))}n&&n.success?(d("âœ… Sidebar opened successfully!"),setTimeout(()=>{d(""),window.close()},1500)):(d("Sidebar opened but may not be fully functional. Check the page for the sidebar."),setTimeout(()=>d(""),3e3))}catch(e){console.error("LearnSphere Popup: Error opening sidebar:",e);const t=e instanceof Error?e.message:String(e);t.includes("Could not establish connection")?(d('âŒ Content script not loaded. Try refreshing the page or use "Inject Content Script" button.'),setTimeout(()=>d(""),5e3)):t.includes("Receiving end does not exist")?(d('âŒ Content script not responding. Use "Inject Content Script" button to fix this.'),setTimeout(()=>d(""),5e3)):(d(`âŒ Failed to open sidebar: ${t}`),setTimeout(()=>d(""),5e3))}},className:"primary-button",children:"ðŸš€ Open LearnSphere Sidebar"})]}),(0,n.jsx)("button",{onClick:async()=>{console.log("LearnSphere Popup: Debugging storage...");try{const e=await chrome.storage.local.get(null);console.log("LearnSphere Popup: All items in storage:",e),d("Debugged storage. Check console for details."),setTimeout(()=>d(""),5e3)}catch(e){console.error("LearnSphere Popup: Error debugging storage:",e),d("Failed to debug storage. Please check console."),setTimeout(()=>d(""),5e3)}},className:"debug-button",children:"Debug Storage"}),(0,n.jsx)("button",{onClick:async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.id&&(console.log("LearnSphere: Manually injecting content script..."),await chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]}),await chrome.scripting.insertCSS({target:{tabId:e.id},files:["content.css"]}),d("Content script injected successfully! Check console for LearnSphere messages."),setTimeout(()=>d(""),3e3))}catch(e){console.error("LearnSphere: Manual injection failed:",e),d("Manual injection failed. Check console for details."),setTimeout(()=>d(""),3e3)}},className:"debug-button",children:"Inject Content Script"}),(0,n.jsx)("button",{onClick:async()=>{try{console.log("LearnSphere: Testing service worker...");const e=await chrome.runtime.sendMessage({action:"testServiceWorker"});console.log("LearnSphere: Service worker response:",e),e&&e.success?d(`âœ… Service worker is working! ${e.message}`):d("âŒ Service worker test failed")}catch(e){console.error("LearnSphere: Service worker test failed:",e),d("âŒ Service worker test failed - check console for details")}setTimeout(()=>d(""),5e3)},className:"debug-button",children:"Test Service Worker"})]})]}),(0,n.jsx)("div",{className:"popup-footer",children:(0,n.jsx)("p",{children:"Select text in any PDF to start learning!"})})]})},{})}))},848:(e,t,s)=>{e.exports=s(20)}},s={};function n(e){var o=s[e];if(void 0!==o)return o.exports;var r=s[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,s,o,r)=>{if(!s){var a=1/0;for(d=0;d<e.length;d++){for(var[s,o,r]=e[d],i=!0,c=0;c<s.length;c++)(!1&r||a>=r)&&Object.keys(n.O).every(e=>n.O[e](s[c]))?s.splice(c--,1):(i=!1,r<a&&(a=r));if(i){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,o,r]},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={887:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[a,i,c]=s,l=0;if(a.some(t=>0!==e[t])){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(c)var d=c(n)}for(t&&t(s);l<a.length;l++)r=a[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},s=self.webpackChunklearnsphere_ce=self.webpackChunklearnsphere_ce||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=n.O(void 0,[338,329],()=>n(131));o=n.O(o)})();