(()=>{"use strict";var e,t={131:(e,t,s)=>{var n=s(848),i=s(540),a=s(338),o=s(329);a.createRoot(document.getElementById("root")).render((0,n.jsx)(i.StrictMode,{children:(0,n.jsx)(()=>{const[e,t]=(0,i.useState)(""),[s,a]=(0,i.useState)(!1),[r,c]=(0,i.useState)(!1),[l,d]=(0,i.useState)(""),[u,h]=(0,i.useState)(!1),[p]=(0,i.useState)(()=>o.h.getInstance());(0,i.useEffect)(()=>{g()},[]);const g=async()=>{console.log("LearnSphere Popup: Loading settings..."),await p.reloadSettings();const e=p.getGeminiApiKey();console.log("LearnSphere Popup: Retrieved API key:",e?"EXISTS":"NOT FOUND"),t(e||"");const s=p.validateApiKey(e);if(a(s),console.log("LearnSphere Popup: API key valid:",s),s&&e)try{console.log("LearnSphere Popup: Testing API key...");const t=await p.testApiKey(e);console.log("LearnSphere Popup: API key test result:",t),h(t.valid),t.valid&&(await m(),u&&(d("Extension is already active! Closing popup..."),setTimeout(()=>{window.close()},1500)))}catch(e){console.error("LearnSphere Popup: Error testing API key:",e),h(!1)}else console.log("LearnSphere Popup: API key not valid or missing"),h(!1)},m=async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e.id)if(e.url&&e.url.toLowerCase().includes(".pdf")){const t=await chrome.tabs.sendMessage(e.id,{action:"checkExtensionStatus"});t&&t.active&&(d("Extension is already active on this page! Closing popup..."),h(!0),setTimeout(()=>{window.close()},2e3))}else d("Navigate to a PDF page to use LearnSphere"),setTimeout(()=>d(""),3e3)}catch(e){console.log("Extension status check: Content script not loaded yet")}},y=async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t.id&&(await chrome.tabs.sendMessage(t.id,{action:"activateExtension",apiKey:e}),await chrome.tabs.sendMessage(t.id,{action:"showReadyMessage",message:"LearnSphere is now active! Select text in the PDF to start learning."}))}catch(e){console.log("Extension activation message sent (content script may not be loaded yet)")}};return(0,n.jsxs)("div",{className:"popup",children:[(0,n.jsxs)("div",{className:"popup-header",children:[(0,n.jsx)("h1",{children:"LearnSphere"}),(0,n.jsx)("p",{children:"AI-Powered PDF Learning Assistant"})]}),(0,n.jsxs)("div",{className:"popup-content",children:[(0,n.jsxs)("div",{className:"api-key-section",children:[(0,n.jsx)("h3",{children:"Gemini API Configuration"}),(0,n.jsxs)("p",{className:"description",children:["Enter your Google Gemini API key to enable AI features. Get your key from ",(0,n.jsx)("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",children:"Google AI Studio"}),"."]}),(0,n.jsxs)("div",{className:"input-group",children:[(0,n.jsx)("input",{type:"password",value:e,onChange:e=>{const s=e.target.value;t(s),a(p.validateApiKey(s)),d(""),h(!1)},placeholder:"Enter your Gemini API key",className:s?"valid":e?"invalid":""}),(0,n.jsxs)("div",{className:"validation-indicator",children:[s&&(0,n.jsx)("span",{className:"valid",children:"âœ“"}),e&&!s&&(0,n.jsx)("span",{className:"invalid",children:"âœ—"})]})]}),(0,n.jsxs)("div",{className:"button-group",children:[(0,n.jsx)("button",{onClick:async()=>{if(s){c(!0),d("");try{await p.setGeminiApiKey(e),(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:"Hello"}]}],generationConfig:{temperature:.1,topK:1,topP:.1,maxOutputTokens:10}})})).ok?(d("API key saved and tested successfully!"),h(!0),await y(),await g(),setTimeout(()=>{d("Extension activated! Closing popup..."),setTimeout(()=>{window.close()},1e3)},2e3)):(d("API key saved but test failed. Please check your key."),h(!1),setTimeout(()=>d(""),5e3))}catch(e){d("Failed to save API key. Please try again."),console.error("Error saving API key:",e)}finally{c(!1)}}else d("Please enter a valid Gemini API key")},disabled:!s||r,className:"primary-button",children:r?"Saving...":"Save API Key"}),(0,n.jsx)("button",{onClick:async()=>{c(!0);try{await p.setGeminiApiKey(""),t(""),a(!1),d("API key cleared successfully!")}catch(e){d("Failed to clear API key. Please try again.")}finally{c(!1)}},disabled:!e||r,className:"secondary-button",children:"Clear"})]}),l&&(0,n.jsx)("div",{className:"message "+(l.includes("successfully")?"success":"error"),children:l})]}),(0,n.jsxs)("div",{className:"features-section",children:[(0,n.jsx)("h3",{children:"Features"}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"âœ… PDF Viewer Override"}),(0,n.jsx)("li",{children:"âœ… Text & Area Selection"}),(0,n.jsx)("li",{children:"âœ… Highlighting System"}),(0,n.jsx)("li",{children:"âœ… Chat Sidebar"}),(0,n.jsxs)("li",{children:[u?"âœ…":"âŒ"," AI Chat (Gemini)"]}),(0,n.jsxs)("li",{children:[u?"âœ…":"âŒ"," Document Summaries"]}),(0,n.jsxs)("li",{children:[u?"âœ…":"âŒ"," Quiz Generation"]})]}),(0,n.jsxs)("div",{className:"api-status "+(u?"active":"warning"),children:[(0,n.jsx)("div",{className:"status-indicator",children:u?"âœ…":"âš ï¸"}),(0,n.jsx)("span",{children:u?"API Key Active & Working":"API Key Saved but Not Working"})]}),u&&(0,n.jsxs)("div",{className:"extension-status",children:[(0,n.jsx)("div",{className:"status-indicator active",children:"ðŸš€"}),(0,n.jsx)("span",{children:"Extension Ready to Use"})]}),u&&(0,n.jsxs)("div",{className:"user-instructions",children:[(0,n.jsx)("h3",{children:"ðŸŽ¯ How to Use LearnSphere:"}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Select Text:"})," Click and drag to select any text in the PDF"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Chat Button:"}),' A "ðŸ’¬ Chat about this" button will appear above your selection']}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Click to Chat:"})," Click the button to open the AI chat sidebar"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Ask Questions:"})," Ask the AI about the selected text, request summaries, or generate quizzes"]})]}),(0,n.jsxs)("div",{className:"instruction-note",children:["ðŸ’¡ ",(0,n.jsx)("strong",{children:"Tip:"})," The popup will close automatically so you can start using the extension!"]})]})]}),(0,n.jsxs)("div",{className:"actions-section",children:[(0,n.jsx)("button",{onClick:()=>{chrome.runtime.openOptionsPage()},className:"secondary-button",children:"Open Settings"}),(0,n.jsx)("button",{onClick:g,className:"refresh-button",children:"Refresh Status"}),u&&(0,n.jsx)("button",{onClick:y,className:"activate-button",children:"Activate Extension"}),(0,n.jsx)("button",{onClick:async()=>{console.log("LearnSphere Popup: Debugging storage...");try{const e=await chrome.storage.local.get(null);console.log("LearnSphere Popup: All items in storage:",e),d("Debugged storage. Check console for details."),setTimeout(()=>d(""),5e3)}catch(e){console.error("LearnSphere Popup: Error debugging storage:",e),d("Failed to debug storage. Please check console."),setTimeout(()=>d(""),5e3)}},className:"debug-button",children:"Debug Storage"}),(0,n.jsx)("button",{onClick:async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.id&&(console.log("LearnSphere: Manually injecting content script..."),await chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]}),await chrome.scripting.insertCSS({target:{tabId:e.id},files:["content.css"]}),d("Content script injected successfully! Check console for LearnSphere messages."),setTimeout(()=>d(""),3e3))}catch(e){console.error("LearnSphere: Manual injection failed:",e),d("Manual injection failed. Check console for details."),setTimeout(()=>d(""),3e3)}},className:"debug-button",children:"Inject Content Script"}),(0,n.jsx)("button",{onClick:async()=>{try{console.log("LearnSphere: Testing service worker...");const e=await chrome.runtime.sendMessage({action:"testServiceWorker"});console.log("LearnSphere: Service worker response:",e),e&&e.success?d(`âœ… Service worker is working! ${e.message}`):d("âŒ Service worker test failed")}catch(e){console.error("LearnSphere: Service worker test failed:",e),d("âŒ Service worker test failed - check console for details")}setTimeout(()=>d(""),5e3)},className:"debug-button",children:"Test Service Worker"})]})]}),(0,n.jsx)("div",{className:"popup-footer",children:(0,n.jsx)("p",{children:"Select text in any PDF to start learning!"})})]})},{})}))}},s={};function n(e){var i=s[e];if(void 0!==i)return i.exports;var a=s[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,s,i,a)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,i,a]=e[d],r=!0,c=0;c<s.length;c++)(!1&a||o>=a)&&Object.keys(n.O).every(e=>n.O[e](s[c]))?s.splice(c--,1):(r=!1,a<o&&(o=a));if(r){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[s,i,a]},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={887:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var i,a,[o,r,c]=s,l=0;if(o.some(t=>0!==e[t])){for(i in r)n.o(r,i)&&(n.m[i]=r[i]);if(c)var d=c(n)}for(t&&t(s);l<o.length;l++)a=o[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},s=self.webpackChunklearnsphere_ce=self.webpackChunklearnsphere_ce||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var i=n.O(void 0,[179,329],()=>n(131));i=n.O(i)})();