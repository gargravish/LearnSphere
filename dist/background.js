(()=>{"use strict";let e;function n(){console.log("ðŸš€ LearnSphere: Keeping service worker alive...")}console.log("ðŸš€ LearnSphere: Background script starting..."),e=setInterval(n,25e3);try{console.log("ðŸš€ LearnSphere: Chrome runtime available:",!!chrome.runtime),console.log("ðŸš€ LearnSphere: Chrome runtime ID:",chrome.runtime.id)}catch(e){console.error("ðŸš€ LearnSphere: Chrome runtime test failed:",e)}function t(){try{chrome.contextMenus.removeAll(()=>{console.log("ðŸš€ LearnSphere: Existing context menus cleared"),chrome.contextMenus.create({id:"test-menu",title:"ðŸš€ Test LearnSphere",contexts:["selection"]}),chrome.contextMenus.create({id:"page-menu",title:"ðŸš€ LearnSphere Page Tools",contexts:["page"]}),console.log("ðŸš€ LearnSphere: Context menus created successfully")})}catch(e){console.error("ðŸš€ LearnSphere: Context menu creation failed:",e)}}chrome.runtime.onMessage.addListener((e,t,r)=>{console.log("ðŸš€ LearnSphere: Received message:",e),"testServiceWorker"===e.action&&(console.log("ðŸš€ LearnSphere: Service worker test successful!"),r({success:!0,message:"Service worker is working!",timestamp:(new Date).toISOString()})),n()}),chrome.contextMenus.onClicked.addListener(async(e,t)=>{if(console.log("ðŸš€ LearnSphere: Context menu clicked:",e.menuItemId),console.log("ðŸš€ LearnSphere: Tab info:",t),n(),t)if(t.id&&-1!==t.id)if(!t.url||t.url.startsWith("chrome://")||t.url.startsWith("chrome-extension://"))console.log("ðŸš€ LearnSphere: Invalid tab URL for injection:",t.url);else try{if("test-menu"===e.menuItemId){console.log("ðŸš€ LearnSphere: Test menu clicked, injecting content script...");const e=t.id;await chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]}),console.log("ðŸš€ LearnSphere: Content script injected successfully"),await chrome.scripting.insertCSS({target:{tabId:e},files:["content.css"]}),console.log("ðŸš€ LearnSphere: CSS injected successfully"),setTimeout(async()=>{try{await chrome.tabs.sendMessage(e,{action:"showNotification",message:"LearnSphere is now active on this page!"}),console.log("ðŸš€ LearnSphere: Notification message sent to content script")}catch(e){console.error("ðŸš€ LearnSphere: Error sending notification:",e)}},1e3)}else if("page-menu"===e.menuItemId){console.log("ðŸš€ LearnSphere: Page menu clicked, injecting content script...");const e=t.id;await chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]}),console.log("ðŸš€ LearnSphere: Page content script injected successfully"),setTimeout(async()=>{try{await chrome.tabs.sendMessage(e,{action:"showNotification",message:"LearnSphere activated for page-level features!"})}catch(e){console.error("ðŸš€ LearnSphere: Error sending page message:",e)}},1e3)}}catch(n){console.error("ðŸš€ LearnSphere: Error handling context menu action:",n),console.error("ðŸš€ LearnSphere: Error details:",{tabId:t?.id,tabUrl:t?.url,menuItemId:e.menuItemId,error:n instanceof Error?n.message:String(n)})}else console.log("ðŸš€ LearnSphere: Invalid tab ID:",t.id);else console.log("ðŸš€ LearnSphere: No tab object found")}),chrome.runtime.onInstalled.addListener(()=>{console.log("ðŸš€ LearnSphere: Extension installed/updated, setting up context menus..."),t()}),chrome.runtime.onStartup.addListener(()=>{console.log("ðŸš€ LearnSphere: Extension starting up..."),t()}),t(),chrome.tabs.onUpdated.addListener(async(e,t,r)=>{"complete"===t.status&&r.url&&(console.log("ðŸš€ LearnSphere: Tab updated:",r.url),(r.url.toLowerCase().includes(".pdf")||r.url.includes("application/pdf")||r.url.startsWith("file://"))&&(console.log("ðŸš€ LearnSphere: PDF page detected, will inject content script..."),setTimeout(async()=>{try{console.log("ðŸš€ LearnSphere: Injecting content script on PDF..."),await chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]}),console.log("ðŸš€ LearnSphere: Content script injected on PDF load"),await chrome.scripting.insertCSS({target:{tabId:e},files:["content.css"]}),console.log("ðŸš€ LearnSphere: CSS injected on PDF load"),console.log("ðŸš€ LearnSphere: PDF injection complete")}catch(e){console.error("ðŸš€ LearnSphere: Error injecting on PDF load:",e)}},3e3))),n()}),chrome.runtime.onSuspend.addListener(()=>{console.log("ðŸš€ LearnSphere: Service worker suspending, cleaning up..."),e&&clearInterval(e)}),console.log("ðŸš€ LearnSphere: Background script loaded successfully")})();