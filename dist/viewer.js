(()=>{"use strict";const e=chrome.runtime.getURL("pdf.min.mjs"),t=chrome.runtime.getURL("pdf.worker.min.mjs"),n=chrome.runtime.getURL("pdf_viewer.mjs");async function r(r){const i=await async function(){const n=window._learnsphere_pdfjs_module;if(n)return n;const r=await import(e);return r.GlobalWorkerOptions.workerPort=new Worker(t,{type:"module"}),window._learnsphere_pdfjs_module=r,r}(),c=await async function(){const e=window._learnsphere_pdfjs_viewer;if(e)return e;const t=await import(n);return window._learnsphere_pdfjs_viewer=t.pdfjsViewer||t,window._learnsphere_pdfjs_viewer}(),s=document.getElementById("viewerContainer"),a=document.getElementById("viewer");a.innerHTML="";const d=new c.EventBus,m=new c.PDFLinkService({eventBus:d}),l=new c.PDFFindController({eventBus:d,linkService:m}),u=new c.PDFViewer({container:s,viewer:a,eventBus:d,linkService:m,findController:l,textLayerMode:1});let p;m.setViewer(u),p="string"!=typeof r?URL.createObjectURL(r):r;const w=i.getDocument(p),f=await w.promise;u.setDocument(f),m.setDocument(f),document.getElementById("page").textContent=`1 / ${f.numPages}`,document.getElementById("prev").onclick=()=>{u.currentPageNumber>1&&(u.currentPageNumber-=1,o(u))},document.getElementById("next").onclick=()=>{u.currentPageNumber<f.numPages&&(u.currentPageNumber+=1,o(u))}}function o(e){document.getElementById("page").textContent=`${e.currentPageNumber} / ${e.pagesCount}`}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("open"),t=document.getElementById("file");e.onclick=()=>t.click(),t.onchange=()=>{const e=t.files?.[0];e&&r(e)},document.addEventListener("paste",e=>{const t=e.clipboardData?.items;if(t)for(const n of t)if("image/png"===n.type||"image/jpeg"===n.type){const t=n.getAsFile();if(t){try{chrome.runtime.sendMessage({action:"openSidebar"})}catch{}window.__ls_last_pasted_image=t,e.preventDefault();break}}});const n=new URLSearchParams(location.search).get("file");if(n){const e=decodeURIComponent(n);if(e.startsWith("file://")){console.warn("LearnSphere Viewer: Cannot fetch local file via URL due to browser restrictions. Use Open PDF.");const e=document.getElementById("pdf"),t=document.createElement("div");t.style.color="#e5e7eb",t.style.padding="12px",t.textContent='This is a local PDF. Click "Open PDF" to select the file from disk.',e.appendChild(t)}else r(e)}})})();